<template name="portfolio">
  <div class="portfolio">
    <ul id="display-options">
      <li>
          <input id="show-closed" type="checkbox" checked="{{showClosed}}" />
          <label for="show-closed">show closed positions</label>
      </li>
      <li>
        <label>view as</label>
        <button id="display-percent">%</button>
        <button id="display-amount">$</button>
      </li>
    </ul>

    {{#dataTable selector="portfolio-table" dom=true options=options }}
      {{> portfolio_table this}}
    {{/dataTable}}
    {{> transaction_menu}}
  </div>
</template>

<template name="portfolio_table">
  {{#if currentHoldings}}
  <table>
    <thead>
      <tr>
        <th>symbol</th>
        <th>price</th>
        <th>change</th>
        <th>shares</th>
        <th>cost basis</th>
        <th>market value</th>
        <th>day's gain</th>
        <th>gain</th>
        <th>overall gain</th>
      </tr>
    </thead>
    <tbody>
    {{#each currentHoldings}}
      {{#if visible}}
      <tr>
        <td>{{symbol}}</td>
        <td>{{formatCurrency lastTradePriceOnly}}</td>

        {{#if displayPercent}}
        <td>{{formatPercent changePercent}}</td>
        {{else}}
        <td>{{formatCurrencySign change}}</td>
        {{/if}}

        <td>{{shares}}</td>
        <td>{{formatCurrency costBasis}}</td>
        <td>{{formatCurrency marketValue}}</td>
        <td>{{formatCurrencySign daysGain}}</td>

        {{#if displayPercent}}
        <td>{{formatPercent  gainPercent}}</td>
        {{else}}
        <td>{{formatCurrencySign gain}}</td>
        {{/if}}

        {{#if displayPercent}}
        <td>{{formatPercent overallGainPercent}}</td>
        {{else}}
        <td>{{formatCurrencySign overallGain}}</td>
        {{/if}}
      </tr>
      {{/if}}
    {{/each}}
    </tbody>

    {{#with total}}
    <tfoot>
      <tr class="total">
        <td>Total</td>
        <td></td>
        <td></td>
        <td></td>
        <td>{{formatCurrency costBasis}}</td>
        <td>{{formatCurrency marketValue}}</td>
        <td>{{formatCurrency daysGain}}</td>

        {{#if displayPercent}}
        <td>{{formatPercent  gainPercent}}</td>
        {{else}}
        <td>{{formatCurrency gain}}</td>
        {{/if}}

        {{#if displayPercent}}
        <td>{{formatPercent  overallGainPercent}}</td>
        {{else}}
        <td>{{formatCurrency overallGain}}</td>
        {{/if}}
      </tr>
    </tfoot>
    {{/with}}
  </table>
  {{else}}
  <p>You have no holdings at the moment.</p>
  {{/if}}
</template>